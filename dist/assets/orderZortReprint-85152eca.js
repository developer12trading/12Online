import{j as u,B as F,z as S,k as V,l as J,r as k,o as m,c as b,a,b as C,v as I,i as O,n as T,t as h,F as W,A as Z,e as E,f as L,p as q,h as H,g as G}from"./index-c17fb389.js";import{S as d}from"./sweetalert2.all-9555961e.js";import{S as K}from"./searchbar-90305c5c.js";import{T as Q}from"./tableCheckbox-ac119441.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";const $={components:{SearchOrder:K,TableOrder:Q},setup(){const c=u(!0);F();const l=u([]),_=S(()=>[{id:"updatedatetime",title:"วันที่อัปเดต"},{id:"number",title:"หมายเลขออเดอร์"},{id:"id",title:"ID"},{id:"saleschannel",title:"ช่องทางขาย"},{id:"invno",title:"invno"},{id:"cono",title:"cono"}]),e=u(""),n=u(""),x=u(!1),f=u(""),i=u([]),s=u(!1),D=()=>{document.querySelector('[class*="w-18"]')?c.value=!0:c.value=!1},R=()=>{e.value&&(localStorage.setItem("reprintStartDate",e.value),console.log("Saved startDate:",e.value)),n.value&&(localStorage.setItem("reprintEndDate",n.value),console.log("Saved endDate:",n.value)),w()},A=()=>({dateStart:e.value||null,dateEnd:n.value||null}),B=()=>e.value&&n.value?`${e.value} - ${n.value}`:e.value?`ตั้งแต่ ${e.value}`:n.value?`ถึง ${n.value}`:"ทั้งหมด",j=()=>{e.value="",n.value="",localStorage.removeItem("reprintStartDate"),localStorage.removeItem("reprintEndDate"),w()},w=async()=>{try{x.value=!0;const r=JSON.parse(localStorage.getItem("token")),o=await fetch("http://192.168.2.97:8383/zort/rest12Tzort/12Trading/getOrder",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({page:"reprint",startDate:e.value||"",endDate:n.value||""})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();console.log("API Response:",t),t&&Array.isArray(t)?(localStorage.setItem("reprintOrders",JSON.stringify(t)),l.value=t):l.value=[]}catch(r){console.error("Error loading data:",r),d.fire({icon:"error",title:"เกิดข้อผิดพลาด!",text:"ไม่สามารถโหลดข้อมูลได้"})}finally{x.value=!1}},p=S(()=>{let r=l.value;if((e.value||n.value)&&(r=r.filter(o=>{const t=new Date(o.updatedatetime),v=e.value?new Date(e.value):null,g=n.value?new Date(n.value):null;return v&&g?t>=v&&t<=g:v?t>=v:g?t<=g:!0})),f.value){const o=f.value.toLowerCase();r=r.filter(t=>(t.number||"").toLowerCase().includes(o)||(t.id||"").toString().toLowerCase().includes(o)||(t.updatedatetime||"").toLowerCase().includes(o)||(t.saleschannel||"").toLowerCase().includes(o)||(t.invno||"").toLowerCase().includes(o)||(t.cono||"").toString().toLowerCase().includes(o))}return r}),N=S(()=>{const r={};return p.value.forEach(o=>{const t=o.updatedatetime;t&&(r[t]=(r[t]||0)+1)}),Object.entries(r).map(([o,t])=>({date:o,count:t})).sort((o,t)=>new Date(o.date)-new Date(t.date))}),P=async r=>{f.value=r,await w()},z=r=>{console.log("onSelectedUpdate called with:",r),i.value=r,s.value=i.value.length>0,console.log("selected.value after update:",i.value)},M=async()=>{if(i.value.length===0){d.fire({icon:"warning",title:"กรุณาเลือกรายการ",text:"โปรดเลือกรายการที่ต้องการพิมพ์สำเนา"});return}try{d.fire({icon:"info",title:"กำลังพิมพ์สำเนา",text:`กำลังพิมพ์ ${i.value.length} ใบ...`,showConfirmButton:!1,allowOutsideClick:!1}),console.log("Selected value:",i.value),console.log("Selected type:",typeof i.value),console.log("Selected length:",i.value.length);const r=i.value.join(",");console.log("ID String:",r);const o=`http://58.181.206.156:8080/12Trading/zort_pdf/printReceiptOriginalSuccessERP.php?checklist=${r}`;console.log("Print URL:",o),window.open(o,"_blank"),await new Promise(t=>setTimeout(t,1e3)),d.fire({icon:"success",title:"เปิดหน้าพิมพ์แล้ว!",text:`เปิดหน้าพิมพ์ ${i.value.length} ใบเรียบร้อยแล้ว`})}catch(r){console.error("Error during print:",r),d.fire({icon:"error",title:"เกิดข้อผิดพลาด!",text:"ไม่สามารถพิมพ์ได้"})}},Y=async()=>{if(p.value.length===0){d.fire({icon:"warning",title:"ไม่มีข้อมูล",text:"ไม่พบรายการที่สามารถพิมพ์ได้"});return}try{d.fire({icon:"info",title:"กำลังพิมพ์ทั้งหมด",text:`กำลังพิมพ์ ${p.value.length} ใบ...`,showConfirmButton:!1,allowOutsideClick:!1});const o=`http://58.181.206.156:8080/12Trading/zort_pdf/printReceiptOriginalSuccessERP.php?checklist=${p.value.map(t=>t.id).join(",")}`;console.log("Print All URL:",o),window.open(o,"_blank"),await new Promise(t=>setTimeout(t,1e3)),d.fire({icon:"success",title:"เปิดหน้าพิมพ์แล้ว!",text:`เปิดหน้าพิมพ์ทั้งหมด ${p.value.length} ใบเรียบร้อยแล้ว`})}catch(r){console.error("Error during print all:",r),d.fire({icon:"error",title:"เกิดข้อผิดพลาด!",text:"ไม่สามารถพิมพ์ได้"})}};return V(async()=>{try{D();const r=localStorage.getItem("reprintStartDate"),o=localStorage.getItem("reprintEndDate");if(r&&o)e.value=r,n.value=o;else{const y=new Date().toISOString().split("T")[0];e.value=y,n.value=y,localStorage.setItem("reprintStartDate",y),localStorage.setItem("reprintEndDate",y)}const t=localStorage.getItem("reprintOrders");if(t)try{l.value=JSON.parse(t)}catch(g){console.error("Error parsing reprint orders:",g),l.value=[]}await w();const v=new MutationObserver(D);v.observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["class"]}),J(()=>{v.disconnect()})}catch(r){console.error("Error in onMounted:",r)}}),{isCollapsed:c,orders:l,tableColumns:_,startDate:e,endDate:n,isLoading:x,textInput:f,selected:i,isItemSelected:s,filteredItems:p,dateWiseCounts:N,clearDateFilter:j,getDateRange:A,getDateRangeText:B,searchDate:R,handleSearch:P,onSelectedUpdate:z,printCopy:M,printAll:Y}}},U=c=>(q("data-v-0554b8e6"),c=c(),H(),c),ee={class:"p-4"},te={class:"flex flex-col-reverse sm:flex-row justify-end items-center mb-4"},re={class:"mr-auto flex items-center space-x-3 ml-2"},oe={class:"flex items-center space-x-2 bg-white rounded-lg p-2 shadow-md"},ae={class:"flex items-center space-x-2"},le=U(()=>a("label",{class:"text-sm font-medium text-gray-700"},"วันที่เริ่มต้น:",-1)),se={class:"flex items-center space-x-2"},ne=U(()=>a("label",{class:"text-sm font-medium text-gray-700"},"วันที่สิ้นสุด:",-1)),ie={class:"flex items-center sm:order-1 mb-4 sm:mb-0 ml-4"},de={class:"flex items-center space-x-2"},ce={class:"mb-4"},ue={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},ve={class:"flex items-center flex-wrap gap-2"},ge={key:0,class:"flex items-center space-x-2 flex-wrap"},me={key:1,class:"ml-4 text-green-700 font-medium"},be={class:"font-bold"},fe={class:"relative flex justify-center m-2 mt-0 md:h-[470px] lg:h-[650px] overflow-y-scroll shadow-md sm:rounded-lg",style:{height:"calc(100vh - 280px)"}},pe={key:0,class:"absolute inset-0 bg-white flex items-center justify-center z-50"},he=G('<div class="flex flex-col items-center space-y-6" data-v-0554b8e6><div class="relative w-64 h-16 overflow-hidden" data-v-0554b8e6><div class="absolute bottom-0 w-full h-2 bg-gray-400 rounded-full" data-v-0554b8e6></div><div class="absolute bottom-2 animate-car" data-v-0554b8e6><div class="relative" data-v-0554b8e6><div class="w-16 h-8 bg-[#0369A1] rounded-lg relative" data-v-0554b8e6><div class="absolute top-1 left-2 w-3 h-2 bg-blue-200 rounded-sm" data-v-0554b8e6></div><div class="absolute top-1 right-2 w-3 h-2 bg-blue-200 rounded-sm" data-v-0554b8e6></div><div class="absolute top-1 left-1 w-1 h-1 bg-yellow-300 rounded-full" data-v-0554b8e6></div><div class="absolute top-1 right-1 w-1 h-1 bg-yellow-300 rounded-full" data-v-0554b8e6></div></div><div class="absolute -bottom-1 left-1 w-3 h-3 bg-gray-800 rounded-full border-2 border-gray-600" data-v-0554b8e6></div><div class="absolute -bottom-1 right-1 w-3 h-3 bg-gray-800 rounded-full border-2 border-gray-600" data-v-0554b8e6></div></div></div></div><div class="text-center" data-v-0554b8e6><div class="text-lg font-semibold text-gray-700 mb-2" data-v-0554b8e6>กำลังโหลดข้อมูล...</div><div class="text-sm text-gray-500" data-v-0554b8e6>กรุณารอสักครู่</div></div></div>',1),xe=[he],we={key:1,class:"w-full"};function ye(c,l,_,e,n,x){const f=k("SearchOrder"),i=k("TableOrder");return m(),b("div",{class:T(["p-4 transition-all duration-100 ease-in-out",e.isCollapsed?"ml-20":"ml-64"])},[a("div",ee,[a("div",te,[a("div",re,[a("div",oe,[a("div",ae,[le,C(a("input",{"onUpdate:modelValue":l[0]||(l[0]=s=>e.startDate=s),type:"text",placeholder:"YYYY-MM-DD",class:"px-3 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"},null,512),[[I,e.startDate]])]),a("div",se,[ne,C(a("input",{"onUpdate:modelValue":l[1]||(l[1]=s=>e.endDate=s),type:"text",placeholder:"YYYY-MM-DD",class:"px-3 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"},null,512),[[I,e.endDate]])]),a("button",{onClick:l[2]||(l[2]=(...s)=>e.searchDate&&e.searchDate(...s)),class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded text-sm font-medium transition-colors"}," ค้นหา "),a("button",{onClick:l[3]||(l[3]=(...s)=>e.clearDateFilter&&e.clearDateFilter(...s)),class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-1 rounded text-sm font-medium transition-colors"}," ล้าง ")])]),a("div",ie,[O(f,{searchBar:e.textInput,onSearch:e.handleSearch},null,8,["searchBar","onSearch"])]),a("div",de,[a("button",{onClick:l[4]||(l[4]=(...s)=>e.printCopy&&e.printCopy(...s)),class:T(["bg-green-500 hover:bg-green-600 text-white shadow-lg border border-green-500 hover:border-green-600 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-md text-sm px-5 py-2 text-center mb-2 sm:mb-0 dark:bg-green-600 dark:text-green-500 dark:hover:text-white dark:hover:bg-green-700 dark:focus:ring-green-800",{"pointer-events-none opacity-50":!e.isItemSelected}])}," พิมพ์สำเนา "+h(e.selected.length>0?e.selected.length+" ใบ":""),3),a("button",{onClick:l[5]||(l[5]=(...s)=>e.printAll&&e.printAll(...s)),class:"bg-blue-500 hover:bg-blue-600 text-white shadow-lg border border-blue-500 hover:border-blue-600 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-md text-sm px-5 py-2 text-center mb-2 sm:mb-0 dark:bg-blue-600 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-700 dark:focus:ring-blue-800"}," พิมพ์ทั้งหมด "+h(e.filteredItems.length>0?e.filteredItems.length+" ใบ":""),1)])]),a("div",ce,[a("div",ue,[a("div",ve,[e.dateWiseCounts.length>0?(m(),b("div",ge,[(m(!0),b(W,null,Z(e.dateWiseCounts,s=>(m(),b("span",{key:s.date,class:"bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full"},h(s.date)+" : "+h(s.count)+" รายการ ",1))),128))])):E("",!0),e.selected.length>0?(m(),b("span",me,[L(" เลือกแล้ว: "),a("span",be,h(e.selected.length),1),L(" รายการ ")])):E("",!0)])])]),a("div",fe,[e.isLoading?(m(),b("div",pe,xe)):(m(),b("div",we,[O(i,{data:e.filteredItems,columns:e.tableColumns,selected:e.selected,onSelectedUpdate:e.onSelectedUpdate,isLoading:e.isLoading},null,8,["data","columns","selected","onSelectedUpdate","isLoading"])]))])])],2)}const Ie=X($,[["render",ye],["__scopeId","data-v-0554b8e6"]]);export{Ie as default};
